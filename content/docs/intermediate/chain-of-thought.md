---
weight: 52
title: "思考の連鎖を促す"
description: "Chain of thoughtを理解する"
icon: "Steppers"
date: "2024-01-24T07:21:48+09:00"
lastmod: "2026-02-12T00:00:00+09:00"
draft: false
toc: true
---

{{< alert icon="🛸" context="dark" text="発展的な内容を含むページです" />}}

プロンプトエンジニアリングについて語るときに欠かせない技術が[思考の連鎖(Chain of thought;CoT)](https://arxiv.org/abs/2201.11903)です。
CoTは幅広く活用できる技術であるためFew-Shotプロンプティングや[Least-to-mostプロンプティング](https://arxiv.org/abs/2205.10625)とも大きく関係しています。

{{% alert icon="" context="info" %}}
(当然ですが)はじめから重複も漏れも無く体系化されているわけではないので、テクニック同士が競合・重複していることはよくあります。あまり気にしないでください。
{{% /alert %}}

{{% alert icon="📖" context="light" %}}
参考論文：Wei, J. et al. (2022). "Chain-of-Thought Prompting Elicits Reasoning in Large Language Models." [arXiv:2201.11903](https://arxiv.org/abs/2201.11903)
{{% /alert %}}

{{< table "table-responsive" >}}
| 日時 | このページで使用した生成AI |
|----------|--------------|
| 2024/1/24 | ChatGPT |
{{< /table >}}

<br>


## Chain of thoughtをざっくり理解する

CoTは数値計算タスクの回答精度を上げるテクニックとして注目されました。
CoT発表時と比べてLLMの精度は大きく向上しましたが、今でも複雑な推論タスクでは有効な手法です。

### - 通常のプロンプトの場合

まずは通常のプロンプトで質問してみます。

```
このグループの奇数を合計すると偶数になります。: 15、32、5、13、82、7、1。
```

{{% alert icon="🤖" context="success" %}}
与えられた数の合計を計算しましょう。

15 + 32 + 5 + 13 + 82 + 7 + 1 = 155

合計は155です。この合計は奇数です。したがって、与えられたグループの奇数を合計しても奇数になります。
{{% /alert %}}

合計や奇数・偶数の判定結果は正解ですが、「このグループの奇数を合計する」という要件は満たしていません。
全ての数を合計してしまっています。

### - CoTプロンプトの場合

そこで**思考の過程**をプロンプトに追加してみます。
解答に至るまでのステップを例示することで、生成AIが同じ思考プロセスを辿るように誘導します。

```
このグループの奇数を合計すると偶数になります。: 4、8、9、15、12、2、1。
A: 奇数を全て加えると(9, 15, 1)25になります。答えはFalseです。

このグループの奇数を合計すると偶数になります。: 17、10、19、4、8、12、24。
A: 奇数を全て加えると(17, 19)36になります。答えはTrueです。

このグループの奇数を合計すると偶数になります。: 16、11、14、4、8、13、24。
A: 奇数を全て加えると(11, 13)24になります。答えはTrueです。

このグループの奇数を合計すると偶数になります。: 17、9、10、12、13、4、2。
A: 奇数を全て加えると(17, 9, 13)39になります。答えはFalseです。

このグループの奇数を合計すると偶数になります。: 15、32、5、13、82、7、1。
A:
```

{{% alert icon="🤖" context="success" %}}
奇数を全て加えると(15, 5, 13, 7, 1)41になります。答えはFalseです。
{{% /alert %}}

このように思考の過程をプロンプトに明記することで、生成AIはグループ内の奇数を正しく選択・合計し、「このグループの奇数を合計すると偶数になります。」という命題に回答(False)を返しました。ここでは「プロンプトと回答のセットをいくつか例示する」というFew-Shotプロンプティングも使用されています。なお一つも例示しないプロンプトはZero-shotプロンプティングと呼ばれています。

{{% alert icon="" context="warning" %}}
現時点では、そもそも生成AI(LLM)が苦手とする数値計算は従来の計算機に任せた方が良いかもしれません。
{{% /alert %}}

<br>

## Zero-shot CoT：「ステップバイステップで考えて」

Few-Shotの例を用意するのは手間がかかります。
実はもっと簡単にCoTの効果を得る方法があります。プロンプトの最後に**「ステップバイステップで考えてください」**と一言添えるだけです。これをZero-shot CoTと呼びます。

### - Zero-shot CoTなしの場合

```
大学の学部新設にあたり、設置審査の申請から認可までの一般的な流れを教えてください。
```

{{% alert icon="🤖" context="success" %}}
大学の学部新設には文部科学省への設置認可申請が必要です。主な流れとしては、設置計画の策定、設置認可申請書の提出、大学設置・学校法人審議会による審査、文部科学大臣による認可という手順になります。審査は書面審査と実地審査があり、通常は申請から認可まで1年程度かかります。
{{% /alert %}}

概要は分かりますが、具体的なステップや注意点が見えにくい回答です。

### - Zero-shot CoTありの場合

```
大学の学部新設にあたり、設置審査の申請から認可までの一般的な流れを教えてください。
ステップバイステップで考えてください。
```

{{% alert icon="🤖" context="success" %}}
大学の学部新設の流れをステップごとに整理します。

**ステップ1：構想・計画段階**
まず、新学部の教育理念・目的、カリキュラム、入学定員、教員組織などの基本計画を策定します。学内での合意形成や、設置の必要性に関する根拠資料の準備も行います。

**ステップ2：事前相談**
文部科学省に対して事前相談を行います。設置計画の概要を説明し、申請に向けた助言を受けます。この段階で大きな問題点を洗い出すことができます。

**ステップ3：設置認可申請書の作成・提出**
所定の様式に従い、設置認可申請書を作成します。教育課程、教員組織、施設・設備、財務計画など、多岐にわたる書類を準備します。通常、開設予定年度の前年の3月末頃までに提出します。

**ステップ4：大学設置・学校法人審議会による審査**
提出された申請書を、大学設置・学校法人審議会が審査します。書面審査のほか、必要に応じて面接審査や実地審査が行われます。審査過程では「是正意見」や「改善意見」が付されることがあり、それに対する回答や修正が求められます。

**ステップ5：審査結果の答申**
審議会が審査結果を文部科学大臣に答申します。「可」「不可」「保留」などの判定が行われます。

**ステップ6：文部科学大臣による認可**
答申を受けて、文部科学大臣が認可の可否を決定します。認可が下りるのは通常、開設予定年度の前年の10月頃です。

**ステップ7：開設準備**
認可後、学生募集の開始、施設の最終整備、教職員の採用・配置など、開設に向けた具体的な準備を進めます。

このように、構想から開設まで最低でも2〜3年程度の期間が必要になります。
{{% /alert %}}

「ステップバイステップで考えてください」を加えるだけで、各段階の詳細や時期の目安まで含む回答が得られました。

<br>

## 大学業務での活用例
---

CoTが特に有効なのは、**複雑な判断や多段階の推論が必要な場面**です。

### - 規程の解釈

```
以下の休学規程を読み、下記の学生のケースについて判断してください。
ステップバイステップで、適用される条項を一つずつ確認しながら回答してください。

### 規程（抜粋） ###
第5条 休学期間は1学期または1年とする。
第6条 休学は通算して2年を超えることはできない。
第7条 休学の申請は、原則として学期開始の1ヶ月前までに行うものとする。
第8条 やむを得ない事由がある場合は、学期途中の休学を認めることがある。

### 学生のケース ###
3年生のAさんは過去に1年間休学しています。
体調不良により6月（前期の途中）から1年間の休学を希望しています。
```

{{% alert icon="🤖" context="success" %}}
ステップバイステップで確認していきます。

**ステップ1：休学期間の確認（第5条）**
Aさんは1年間の休学を希望しています。第5条では休学期間は「1学期または1年」と定められているため、1年間の休学申請は規程上認められる期間です。

**ステップ2：通算休学期間の確認（第6条）**
Aさんは過去に1年間休学しています。今回さらに1年間の休学を希望しているため、通算の休学期間は2年になります。第6条では「通算して2年を超えることはできない」と定められているため、通算2年はぎりぎり規程の範囲内です。

**ステップ3：申請時期の確認（第7条・第8条）**
Aさんは6月（前期の途中）からの休学を希望しています。第7条では「学期開始の1ヶ月前まで」の申請が原則ですが、6月は既に前期が始まった後です。ただし、第8条に「やむを得ない事由がある場合は、学期途中の休学を認めることがある」とあります。Aさんの理由は「体調不良」であり、これは一般的に「やむを得ない事由」に該当し得ます。

**結論：**
- 休学期間（1年間）は第5条の範囲内です。
- 通算休学期間（2年）は第6条の上限ちょうどであり、認められます。
- 申請時期は第7条の原則には反しますが、体調不良という事由により第8条の適用が検討できます。

したがって、第8条の「やむを得ない事由」として体調不良が認められれば、Aさんの休学申請は認められる可能性があります。ただし、最終的な判断は大学の所定の手続きに従って行われます。
{{% /alert %}}

規程の各条項を順番に検討するよう指示することで、漏れのない整理された分析を得ることができました。

### - 予算配分の検討

```
以下の条件で学部予算の配分案を検討してください。
各条件を一つずつ確認しながら、段階的に配分を考えてください。

### 条件 ###
- 総予算：1億円
- 学部共通経費（施設維持費等）：全体の30%を確保
- 研究費：教員1人あたり50万円（教員数40名）
- 教育経費：学生1人あたり5万円（学生数800名）
- 残りを学部裁量経費とする
```

{{% alert icon="🤖" context="success" %}}
段階的に配分を計算していきます。

**ステップ1：学部共通経費の算出**
総予算1億円の30% = 3,000万円
学部共通経費として3,000万円を確保します。

**ステップ2：研究費の算出**
教員1人あたり50万円 × 40名 = 2,000万円
研究費として2,000万円を確保します。

**ステップ3：教育経費の算出**
学生1人あたり5万円 × 800名 = 4,000万円
教育経費として4,000万円を確保します。

**ステップ4：学部裁量経費の算出**
総予算 - 学部共通経費 - 研究費 - 教育経費
= 1億円 - 3,000万円 - 2,000万円 - 4,000万円
= 1,000万円

**配分結果のまとめ：**

| 費目 | 金額 | 割合 |
|:---|---:|---:|
| 学部共通経費 | 3,000万円 | 30% |
| 研究費 | 2,000万円 | 20% |
| 教育経費 | 4,000万円 | 40% |
| 学部裁量経費 | 1,000万円 | 10% |
| **合計** | **1億円** | **100%** |

学部裁量経費は1,000万円（全体の10%）となります。
{{% /alert %}}

<br>

## CoTのポイント
---

CoTを活用する際のポイントをまとめます。

| 方法 | 特徴 | 使いどころ |
|:---|:---|:---|
| Few-shot CoT | 思考の過程を含む例を複数提示する | 定型的なタスクを繰り返す場合 |
| Zero-shot CoT | 「ステップバイステップで考えて」と指示する | 手軽にCoTの効果を得たい場合 |

- CoTは**複雑な推論**や**多段階の判断**が必要なタスクで特に効果的です
- 単純な事実の質問（「日本の首都は？」など）にはCoTは不要です
- 現在のChatGPT等では、内部的にCoTの考え方が取り入れられています

Least-to-mostプロンプティングは大きなタスクを小さなタスクに分解する技術であり、CoTと組み合わせて使うことでより複雑な問題にも対応できます。
